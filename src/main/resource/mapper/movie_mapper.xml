<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wwwy.liuxing.movie.dto.MovieMapper">
    <resultMap id="MovieResultMap" type="com.wwwy.liuxing.movie.dto.MovieDTO">
        <id property="movieId" column="movie_id" javaType="java.lang.Integer"/>
        <result property="movieName" column="movie_name" javaType="java.lang.String"/>
        <result property="movieDirector" column="movie_director" javaType="java.lang.String"/>
        <result property="movieStar" column="movie_star" javaType="java.lang.String"/>
        <result property="movieType" column="movie_type" javaType="java.lang.String"/>
        <result property="movieCountry" column="movie_country" javaType="java.lang.String"/>
        <result property="movieLanguage" column="movie_language" javaType="java.lang.String"/>
        <result property="movieTime" column="movie_time" javaType="java.lang.String"/>
        <result property="movieDetails" column="movie_details" javaType="java.lang.String"/>
        <result property="movieDate" column="movie_date" javaType="java.lang.String"/>
        <result property="movieScore" column="movie_score" javaType="java.lang.String"/>
        <result property="movieImg" column="movie_img" javaType="java.lang.String"/>
        <result property="moviePreparation" column="movie_preparation" javaType="java.lang.String"/>
    </resultMap>

    <!--根据城市名查询所有电影id,电影名，电影图片，电影评分-->
    <select id="queryAllMovieByCityName" resultMap="MovieResultMap">
        select distinct movie.movie_id, movie.movie_name, movie.movie_img, movie.movie_score from tb_movie movie
        join tb_city city
        join tb_area area
        join tb_area_theater area_th
        join tb_theater th
        join tb_hall hall
        join tb_hall_movie hall_movie
        on city.city_id = area.fk_city_id
        and area.area_id = area_th.fk_area_id
        and area_th.fk_theater_id = th.theater_id
        and th.theater_id = hall.fk_theater_id
        and hall.hall_id = hall_movie.fk_hall_id
        and hall_movie.fk_movie_id = movie.movie_id
        where city.city_name=#{cityName}
        order by movie.movie_score desc;
    </select>
    <!--根据影片类型，影片国家，上映时间的一个或多个条件动态查询符合条件的电影-->
    <select id="selectMovieByCondition" resultMap="MovieResultMap">
        SELECT movie_name FROM tb_movie
        <trim prefix="WHERE" prefixOverrides="AND |OR">
            <if test="movieCountry !=null">
                movie_country=#{movieCountry}
            </if>
            <if test="movieDate !=null">
                AND movie_date=#{movieDate}
            </if>
            <if test="movieType !=null">
                AND movie_type=#{movieType}
            </if>
        </trim>
    </select>
</mapper>